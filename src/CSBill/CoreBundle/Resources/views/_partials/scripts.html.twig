{% spaceless %}
{% set compressed = compressed is defined ? compressed : true %}
{% set config_extend %}
    require({
        baseUrl: {{ absolute_url('/bundles')|json_encode|raw }}
    });
    {{ config_extend|default('') }}
{% endset %}
{% if compressed and requirejs_build_exists() %}
    <script type="text/javascript">
        var require = (function(){
            var r=function(c){m(r.c,c)};r.c={};function m(a,b){
                for (var i in b)b[i]!=null&&b[i].toString()==='[object Object]'?m(a[i]||(a[i]={}),b[i]):a[i]=b[i]}
            return r;
        }());
        {{ config_extend|raw }}
        require = require.c;
    </script>
    <script type="text/javascript" src="{{ asset(get_requirejs_build_path()) }}"></script>
{% else %}
    <script type="text/javascript" src="{{ asset('bundles/ororequirejs/lib/require.js') }}"></script>
    <script type="text/javascript">
        {{ get_requirejs_config() }}
    </script>
    <script type="text/javascript">
        {{ config_extend|raw }}
    </script>
{% endif %}

<script>
    {% if locale != 'en' %}
    {% set locale = 'en,' ~ locale %}
    {% endif %}
    require({
        paths: {
            'fos_routing_data': '{{ path('fos_js_routing_js', {'callback': 'define'}) }}',
            'translation_data': '{{ path('bazinga_jstranslation_js', {'locales' : locale}) }}'
        },
        urlArgs: 'version={{ asset_version('/')|escape('url') }}'
        {% if module is defined %}
        , module: '{{ module }}'
        {% if moduleData is defined %}
            {% set context = serialization_context() %}

            {% do context.setGroups(["js"]) %}

        , moduleData: {{ moduleData|serialize("json", context)|raw }}
        {% endif %}
        {% endif %}
    });
</script>
{% endspaceless %}
