(function(b,a){var c={el:null,rowElement:"tr",columnElement:"td",fields:[],templates:{},trashTemplate:'<div class="pull-right"><a href="#" class="remove-item" rel="tooltip" title="Remove Item"><i class="icon-trash"></i></a></div>',counter:0,addTemplate:function(e,d){this.templates[e]=d;return this},addField:function(d){this.fields.push(d);return this},setSelector:function(d){this.el=b("tbody",d);return this},addRow:function(){var e=this,f=b(a.document.createElement(this.rowElement)),d=b(".quote-item-total",f);b.each(this.fields,function(g,i){var h=b(a.document.createElement(e.columnElement));h.html(e.createField(i));f.append(h)});this.counter+=1;f.hide();this.el.append(f);f.fadeIn(150,this.setEvents);d.val(accounting.formatMoney(d.val()||0,""));return this},createField:function(e){var d=this.templates[e].replace(/__name__/g,this.counter);return d},setEvents:function(){b(".quote-item-price, .quote-item-qty").unbind("keyup change");b(".quote-item-price, .quote-item-qty").on("keyup",function(){c.calcTotal(this)});b(".quote-item-qty").on("change",function(){var g=b(this),f=g.val(),d,e;if(f.indexOf(".")!==-1){d=f.substr(f.indexOf(".")+1);g.val(accounting.toFixed(g.val(),d.length>2?2:d.length)||1)}else{e=accounting.toFixed(g.val());g.val(e>0?e:1)}c.calcTotal(this)});b(".quote-item-price").on("change",function(){var d=b(this);d.val(accounting.formatMoney(d.val(),"","2"));c.calcTotal(this)})},calcTotal:function(g){var f=b(g).parents("tr"),e=accounting.unformat(b(".quote-item-price",f).val()),h=b(".quote-item-qty",f).val(),d=b(".quote-item-total",f);d.val(accounting.formatMoney(h*e,""));c.updateTotal()},updateTotal:function(){var d=0,e;b(".quote-item-total",this.el).each(function(){d+=parseFloat(accounting.unformat(b(this).val()))});e=(d*parseInt(b("#quote_discount").val()||0,10)/100);b(".quote-discount").html(accounting.formatMoney(e*-1));b(".quote-sub-total").html(accounting.formatMoney(d));b(".quote-total").html(accounting.formatMoney(d-e))}};b(function(){b(".add-item").on("click",function(d){d.preventDefault();c.addRow()});b(".quote-item-price, .quote-item-total",c.el).each(function(){var d=b(this);if(d.val()!==""){d.val(accounting.formatMoney(d.val(),""))}c.calcTotal(this)});b("#quote_discount").on("change keyup",c.updateTotal);b("#quote-create-form").on("submit",function(){b(".quote-item-price",this).each(function(){var d=b(this);d.val(accounting.unformat(d.val()))});return true});b(c.el.selector).on("click",".remove-item",function(d){d.preventDefault();b(this).parents("tr").fadeOut(function(){b(this).remove();c.updateTotal();if(b(c.rowElement,c.el).length===0){c.addRow()}})});c.setEvents()});a.Quote=c})(jQuery,window);