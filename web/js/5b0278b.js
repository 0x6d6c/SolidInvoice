(function(c,b){var a={el:null,rowElement:"tr",columnElement:"td",fields:[],templates:{},trashTemplate:'<div class="pull-right"><a href="#" class="remove-item" rel="tooltip" title="Remove Item"><i class="icon-trash"></i></a></div>',counter:0,addTemplate:function(e,d){this.templates[e]=d;return this},addField:function(d){this.fields.push(d);return this},setSelector:function(d){this.el=c("tbody",d);return this},addRow:function(){var e=this,f=c(b.document.createElement(this.rowElement)),d=c(".invoice-item-total",f);c.each(this.fields,function(g,i){var h=c(b.document.createElement(e.columnElement));h.html(e.createField(i));f.append(h)});this.counter+=1;f.hide();this.el.append(f);f.fadeIn(150,this.setEvents);d.val(accounting.formatMoney(d.val()||0,""));return this},createField:function(e){var d=this.templates[e].replace(/__name__/g,this.counter);return d},setEvents:function(){c(".invoice-item-price, .invoice-item-qty").unbind("keyup change");c(".invoice-item-price, .invoice-item-qty").on("keyup",function(){a.calcTotal(this)});c(".invoice-item-qty").on("change",function(){var g=c(this),f=g.val(),d,e;if(f.indexOf(".")!==-1){d=f.substr(f.indexOf(".")+1);g.val(accounting.toFixed(g.val(),d.length>2?2:d.length)||1)}else{e=accounting.toFixed(g.val());g.val(e>0?e:1)}a.calcTotal(this)});c(".invoice-item-price").on("change",function(){var d=c(this);d.val(accounting.formatMoney(d.val(),"","2"));a.calcTotal(this)})},calcTotal:function(g){var f=c(g).parents("tr"),e=accounting.unformat(c(".invoice-item-price",f).val()),h=c(".invoice-item-qty",f).val(),d=c(".invoice-item-total",f);d.val(accounting.formatMoney(h*e,""));a.updateTotal()},updateTotal:function(){var d=0,e;c(".invoice-item-total",this.el).each(function(){d+=parseFloat(accounting.unformat(c(this).val()))});e=(d*parseInt(c("#invoice_discount").val()||0,10)/100);c(".invoice-discount").html(accounting.formatMoney(e*-1));c(".invoice-sub-total").html(accounting.formatMoney(d));c(".invoice-total").html(accounting.formatMoney(d-e))}};c(function(){c(".add-item").on("click",function(d){d.preventDefault();a.addRow()});c(".invoice-item-price, .invoice-item-total",a.el).each(function(){var d=c(this);if(d.val()!==""){d.val(accounting.formatMoney(d.val(),""))}a.calcTotal(this)});c("#invoice_discount").on("change keyup",a.updateTotal);c("#invoice-create-form").on("submit",function(){c(".invoice-item-price",this).each(function(){var d=c(this);d.val(accounting.unformat(d.val()))});return true});c(a.el.selector).on("click",".remove-item",function(d){d.preventDefault();c(this).parents("tr").fadeOut(function(){c(this).remove();a.updateTotal();if(c(a.rowElement,a.el).length===0){a.addRow()}})});a.setEvents()});b.Invoice=a})(jQuery,window);